# EasyArchitect V2 Lab8 - ç§Ÿè»Šç³»çµ± Web API Framework

## ğŸ“‹ å°ˆæ¡ˆæ¦‚è¿°
æœ¬å°ˆæ¡ˆæ˜¯ä¸€å€‹åŸºæ–¼ **Clean Architectureï¼ˆæ¸…æ½”æ¶æ§‹ï¼‰** èˆ‡ **Hexagonal Architectureï¼ˆå…­è§’æ¶æ§‹ï¼‰** çš„ç¾ä»£åŒ– Web API Frameworkï¼Œä¸»è¦ç”¨æ–¼ç§Ÿè»Šæ¥­å‹™ç³»çµ±çš„é–‹ç™¼ã€‚æ¡ç”¨ ASP.NET Core 8.0 æŠ€è¡“æ£§ï¼Œçµåˆ JWT èº«åˆ†é©—è­‰ã€AOP æ©«åˆ‡é¢ç¨‹å¼è¨­è¨ˆï¼Œä»¥åŠå®Œæ•´çš„æ—¥èªŒè¨˜éŒ„æ©Ÿåˆ¶ã€‚

## ğŸ—ï¸ ç³»çµ±æ¶æ§‹

### æ¶æ§‹æ¨¡å¼
- **Clean Architectureï¼ˆæ¸…æ½”æ¶æ§‹ï¼‰**
- **Hexagonal Architectureï¼ˆå…­è§’æ¶æ§‹ï¼‰**
- **Domain-Driven Design (DDD) æ¦‚å¿µ**
- **Port-Adapter æ¨¡å¼**

### åˆ†å±¤çµæ§‹
```
â”œâ”€â”€ Presentation Layer (è¡¨ç¾å±¤)
â”‚   â”œâ”€â”€ RentalCar8.Web8                      # ASP.NET Core Web ä¸»å°ˆæ¡ˆ
â”‚   â””â”€â”€ EasyArchitectV2Lab8.ApiControllerBase8  # API Controller åŸºåº•é¡åˆ¥
â”œâ”€â”€ Application Layer (æ‡‰ç”¨å±¤)
â”‚   â””â”€â”€ RentalCar8.Application8              # æ‡‰ç”¨æœå‹™èˆ‡ Use Cases
â”‚       â”œâ”€â”€ port/In/                         # è¼¸å…¥åŸ  (Input Ports)
â”‚       â””â”€â”€ port/Out/                        # è¼¸å‡ºåŸ  (Output Ports)
â”œâ”€â”€ Domain Layer (é ˜åŸŸå±¤)
â”‚   â””â”€â”€ RentalCar8.Domain8                   # é ˜åŸŸå¯¦é«”èˆ‡å•†æ¥­é‚è¼¯
â””â”€â”€ Infrastructure Layer (åŸºç¤è¨­æ–½å±¤)
    â”œâ”€â”€ RentalCar8.Infrastructure8           # è³‡æ–™å­˜å–å±¤
    â”œâ”€â”€ EasyArchitectV2Lab8.AuthExtensions8 # èº«åˆ†é©—è­‰æœå‹™
    â””â”€â”€ AOP.ApiControllerBase.ApiLog8        # AOP æ©«åˆ‡é¢åŠŸèƒ½
```

## ğŸ› ï¸ æŠ€è¡“è¦æ ¼

### æ ¸å¿ƒæŠ€è¡“
- **.NET 8.0** - ç›®æ¨™æ¡†æ¶
- **ASP.NET Core 8.0** - Web æ¡†æ¶
- **C# 12.0** - ç¨‹å¼èªè¨€
- **Entity Framework Core 8.0** - ORM æ¡†æ¶
- **SQL Server** - è³‡æ–™åº«

### èº«åˆ†é©—è­‰èˆ‡æˆæ¬Š
- **JWT (JSON Web Token)** - ä¸»è¦èº«åˆ†é©—è­‰æ–¹å¼
- **Cookie Authentication** - è¼”åŠ©èº«åˆ†é©—è­‰
- **è‡ªè¨‚æˆæ¬Šéæ¿¾å™¨** - NeedAuthorizeAttribute
- **Token é©—è­‰ä¸­é–“ä»¶** - JwtService

### æ—¥èªŒè¨˜éŒ„
- **NLog 4.7.13** - æ—¥èªŒæ¡†æ¶
- **AOP æ—¥èªŒè¨˜éŒ„** - ApiLogonInfoAttribute, ApiLogExceptionAttribute
- **çµæ§‹åŒ–æ—¥èªŒ** - åŒ…å«åŸ·è¡Œæ™‚é–“ã€ä½¿ç”¨è€…è³‡è¨Šã€éŒ¯èª¤è¿½è¹¤

### ä¾è³´æ³¨å…¥
- **å…§å»º DI å®¹å™¨** - ASP.NET Core DI
- **Scoped ç”Ÿå‘½é€±æœŸç®¡ç†**
- **ä»‹é¢å°å‘ç¨‹å¼è¨­è¨ˆ**

## ğŸ“Š æ§åˆ¶å™¨èˆ‡ API æ–¹æ³•çµ±è¨ˆ

### MVC Controllers: 1 å€‹
1. **HomeController** (å‚³çµ± MVC Controller)
   - `Index()` - é¦–é æª¢è¦–
   - `Privacy()` - éš±ç§æ¬Šé é¢
   - `Error()` - éŒ¯èª¤é é¢

### Web API Controllers: 2 å€‹

#### 1. EasyArchiectV2ControllerBase (åŸºåº•æ§åˆ¶å™¨)
- **API æ–¹æ³•æ•¸é‡: 1 å€‹**
- `POST /api/EasyArchiectV2ControllerBase/Login` - ä½¿ç”¨è€…ç™»å…¥é©—è­‰

#### 2. RentalCarApiController (ç§Ÿè»Š API æ§åˆ¶å™¨)
- **API æ–¹æ³•æ•¸é‡: 2 å€‹ (1 å€‹è¨»è§£)**
- `GET /api/RentalCarApi/GetPersons` - å–å¾—äººå“¡æ¸…å–® (éœ€è¦é©—è­‰)
- `GET /api/RentalCarApi/GetAllCars` - å–å¾—æ‰€æœ‰å¯å‡ºç§Ÿè»Šè¼›
- `POST /api/RentalCarApi/ToRentalCar` - ç§Ÿè»Šä½œæ¥­ (å·²è¨»è§£)

### Web API æ–¹æ³•åŠŸèƒ½èªªæ˜

| HTTP Method | Route | åŠŸèƒ½èªªæ˜ | æˆæ¬Šéœ€æ±‚ | AOP åŠŸèƒ½ |
|-------------|-------|----------|----------|----------|
| POST | `/api/EasyArchiectV2ControllerBase/Login` | ä½¿ç”¨è€…èº«åˆ†é©—è­‰ç™»å…¥ | âŒ | âŒ |
| GET | `/api/RentalCarApi/GetPersons` | å–å¾—äººå“¡æ¸…å–® (ç¯„ä¾‹) | âœ… | âœ… æ—¥èªŒ+ä¾‹å¤– |
| GET | `/api/RentalCarApi/GetAllCars` | å–å¾—æ‰€æœ‰å¯å‡ºç§Ÿè»Šè¼›æ¸…å–® | âŒ | âœ… æ—¥èªŒ+ä¾‹å¤– |

**ç¸½è¨ˆ: 3 å€‹ Web API æ–¹æ³• (2 å€‹å•Ÿç”¨ï¼Œ1 å€‹è¨»è§£)**

## ğŸ“„ æª¢è¦–è¡¨ (Views) çµ±è¨ˆ

### Razor Views: 7 å€‹æª¢è¦–æª”æ¡ˆ

#### é é¢æª¢è¦– (3 å€‹)
1. `Views/Home/Index.cshtml` - é¦–é 
2. `Views/Home/Privacy.cshtml` - éš±ç§æ¬Šé é¢
3. `Views/Shared/Error.cshtml` - éŒ¯èª¤é é¢

#### å…±ç”¨æª¢è¦– (4 å€‹)
1. `Views/Shared/_Layout.cshtml` - ä¸»è¦ç‰ˆé¢é…ç½®
2. `Views/Shared/_Layout.cshtml.css` - ç‰ˆé¢æ¨£å¼
3. `Views/Shared/_ValidationScriptsPartial.cshtml` - é©—è­‰è…³æœ¬
4. `Views/_ViewImports.cshtml` - æª¢è¦–åŒ¯å…¥è¨­å®š
5. `Views/_ViewStart.cshtml` - æª¢è¦–å•Ÿå‹•è¨­å®š

**ç¸½è¨ˆ: 7 å€‹ Razor æª¢è¦–æª”æ¡ˆ**

## ğŸ¯ AOP æ©«åˆ‡é¢åŠŸèƒ½

### éæ¿¾å™¨ (Filters)
1. **ApiLogonInfoAttribute** - API å‘¼å«æ—¥èªŒè¨˜éŒ„
   - è¨˜éŒ„ API åŸ·è¡Œæ™‚é–“
   - è¨˜éŒ„ä½¿ç”¨è€…è³‡è¨Š
   - è¨˜éŒ„è«‹æ±‚ä¾†æº

2. **ApiLogExceptionAttribute** - ä¾‹å¤–éŒ¯èª¤æ—¥èªŒ
   - æ•æ‰ API åŸ·è¡Œä¾‹å¤–
   - è¨˜éŒ„éŒ¯èª¤å †ç–Šè¿½è¹¤
   - çµæ§‹åŒ–éŒ¯èª¤è³‡è¨Š

3. **NeedAuthorizeAttribute** - æˆæ¬Šé©—è­‰
   - JWT Token é©—è­‰
   - ä½¿ç”¨è€…æ¬Šé™æª¢æŸ¥
   - æœªæˆæ¬Šå›æ‡‰è™•ç†

## ğŸ”§ å°ˆæ¡ˆçµæ§‹è©³ç´°èªªæ˜

### æ ¸å¿ƒå°ˆæ¡ˆ (11 å€‹)

#### è¡¨ç¾å±¤ (Presentation)
- **RentalCar8.Web8** - ä¸»è¦ Web æ‡‰ç”¨ç¨‹å¼ (Razor Pages + Web API)

#### æ‡‰ç”¨å±¤ (Application)  
- **RentalCar8.Application8** - æ‡‰ç”¨æœå‹™ã€Use Casesã€Port å®šç¾©

#### é ˜åŸŸå±¤ (Domain)
- **RentalCar8.Domain8** - é ˜åŸŸå¯¦é«”ã€å•†æ¥­é‚è¼¯ã€ä»‹é¢å®šç¾©

#### åŸºç¤è¨­æ–½å±¤ (Infrastructure)
- **RentalCar8.Infrastructure8** - è³‡æ–™å­˜å–ã€å¤–éƒ¨æœå‹™æ•´åˆ

#### æ¡†æ¶æ”¯æ´å°ˆæ¡ˆ
- **EasyArchitectV2Lab8.ApiControllerBase8** - API Controller åŸºåº•é¡åˆ¥
- **EasyArchitectV2Lab8.AuthExtensions8** - èº«åˆ†é©—è­‰æ“´å……æœå‹™
- **EasyArchitectV2Lab8.JWTMiddleware8** - JWT ä¸­é–“ä»¶æœå‹™
- **EasyArchitectV2Lab8.Configuration8** - çµ„æ…‹è¨­å®šæœå‹™
- **AOP.ApiControllerBase.ApiLog8** - AOP æ—¥èªŒè¨˜éŒ„å¥—ä»¶

#### æ¸¬è©¦å°ˆæ¡ˆ
- **RentalCar8.Domain8Tests** - é ˜åŸŸå±¤å–®å…ƒæ¸¬è©¦

#### æ“´å……å°ˆæ¡ˆ
- **EasyArchitectV2Lab8.AuthExtensions8.Extensions** - é©—è­‰æ“´å……åŠŸèƒ½

## ğŸš€ ç³»çµ±ç‰¹è‰²

### 1. æ¸…æ½”æ¶æ§‹å¯¦ä½œ
- ä¾è³´åè½‰åŸå‰‡ (DIP)
- é—œæ³¨é»åˆ†é›¢ (SoC)
- é«˜å…§èšä½è€¦åˆ

### 2. ç¾ä»£åŒ–èº«åˆ†é©—è­‰
- JWT Token æ©Ÿåˆ¶
- è‡ªå‹• Token é©—è­‰ä¸­é–“ä»¶
- éˆæ´»çš„æˆæ¬Šæ§åˆ¶

### 3. å®Œæ•´æ—¥èªŒç³»çµ±
- çµæ§‹åŒ–æ—¥èªŒè¨˜éŒ„
- æ•ˆèƒ½ç›£æ§ (åŸ·è¡Œæ™‚é–“è¿½è¹¤)
- éŒ¯èª¤è¿½è¹¤èˆ‡å †ç–Šè¨˜éŒ„

### 4. ä¼æ¥­ç´šé–‹ç™¼æ¨¡å¼
- ä¾è³´æ³¨å…¥å®¹å™¨
- AOP æ©«åˆ‡é¢ç¨‹å¼è¨­è¨ˆ
- Port-Adapter æ¨¡å¼
- Use Case é©…å‹•é–‹ç™¼

## ğŸ“¦ å¥—ä»¶å°ˆæ¡ˆ
æœ¬æ–¹æ¡ˆåŒ…å«å¤šå€‹å¯é‡è¤‡ä½¿ç”¨çš„ NuGet å¥—ä»¶å°ˆæ¡ˆï¼š
- `EasyArchitectV2Lab8.ApiControllerBase8` v8.0.0
- `EasyArchitectV2Lab8.AuthExtensions8` v8.0.0  
- `AOP.ApiControllerBase.ApiLog8` v8.0.0

## ğŸ¯ ä½¿ç”¨å ´æ™¯
- ä¼æ¥­ç´š Web API é–‹ç™¼
- å¾®æœå‹™æ¶æ§‹å¯¦ä½œ
- ç§Ÿè»Š/è»Šè¼›ç®¡ç†ç³»çµ±
- éœ€è¦å®Œæ•´èº«åˆ†é©—è­‰çš„æ¥­å‹™ç³»çµ±
- æ•™å­¸ç”¨ç¾ä»£åŒ– .NET æ¶æ§‹ç¯„ä¾‹

## ğŸ“‹ é–‹ç™¼ç’°å¢ƒéœ€æ±‚
- Visual Studio 2022 æˆ– Visual Studio Code
- .NET 8.0 SDK
- SQL Server (LocalDB æˆ–å®Œæ•´ç‰ˆ)
- IIS Express æˆ– Kestrel

---
*æ­¤å°ˆæ¡ˆæ¡ç”¨ Clean Architecture è¨­è¨ˆåŸå‰‡ï¼Œé©åˆä½œç‚ºä¼æ¥­ç´š Web API Framework çš„å­¸ç¿’èˆ‡å¯¦ä½œåƒè€ƒã€‚*